<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ç†Šç†Šå¡”ç¾…å åœ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: "Noto Sans TC", -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(180deg, #2d254a, #6a4f9c, #f9e4c8);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .game-wrap {
      max-width: 480px;
      width: 100%;
      padding: 16px;
      margin-top: 16px;
      position: relative;
      overflow: hidden;
    }
    .card-panel {
      background: rgba(255, 247, 230, 0.95);
      border-radius: 18px;
      border: 2px solid #f7dba5;
      box-shadow: 0 4px 14px rgba(0,0,0,0.25);
      padding: 18px 14px 20px;
      color: #4a3450;
    }
    h1 {
      margin: 0 0 4px;
      font-size: 22px;
      text-align: center;
      letter-spacing: 0.15em;
    }
    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #7c5c88;
      margin-bottom: 12px;
    }
    .star-divider {
      text-align: center;
      font-size: 16px;
      margin-bottom: 10px;
    }
    .btn-bar {
      text-align: center;
      margin-bottom: 10px;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 10px 22px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #ffcf5f, #ff9f7b);
      color: #4a2a18;
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.2s ease;
    }
    button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    /* ä¸‰å¼µç‰Œå€åŸŸ */
    .table {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }
    .slot-title {
      text-align: center;
      font-size: 12px;
      color: #8f6c9b;
      margin-bottom: 4px;
    }
    .card-slot {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* å¡ç‰‡æœ¬é«” */
    .card {
      width: 90px;
      height: 140px;
      perspective: 900px;
      cursor: pointer;
      opacity: 0;
      transform: translateY(20px) scale(0.9);
      pointer-events: none;
    }
    .card.show {
      animation: cardEnter 0.45s forwards;
    }
    .card-inner {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s ease;
    }
    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }
    .card-face {
      position: absolute;
      inset: 0;
      border-radius: 12px;
      backface-visibility: hidden;
      box-shadow: 0 4px 9px rgba(0,0,0,0.25);
    }
    .card-back {
      background: radial-gradient(circle at 30% 20%, #ffeaa7, #f0932b, #e056fd);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      color: #fffdf0;
      border: 2px solid rgba(255,255,255,0.85);
      position: relative;
      overflow: hidden;
    }
    .card-back::before {
      content: "â˜…";
      position: absolute;
      font-size: 48px;
      opacity: 0.2;
      top: -8px;
      right: 8px;
    }
    .card-front {
      transform: rotateY(180deg);
      background: #fff9ef;
      border: 2px solid #f3c79b;
      padding: 10px 7px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .card-name {
      font-size: 13px;
      font-weight: 700;
      text-align: center;
      color: #7a3f5f;
      margin-bottom: 4px;
    }
    .card-tag {
      font-size: 11px;
      text-align: center;
      color: #c77a68;
      margin-bottom: 6px;
    }
    .card-meaning {
      font-size: 11px;
      line-height: 1.4;
      color: #5c3b4c;
      flex: 1;
    }
    .card-icon {
      text-align: center;
      font-size: 18px;
      margin-top: 4px;
    }

    @keyframes cardEnter {
      from { opacity: 0; transform: translateY(20px) scale(0.9); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }

    /* ç†Šç†Šå°è©±æ¡† */
    .bear-dialog {
      position: fixed;
      left: 50%;
      bottom: 8%;
      transform: translateX(-50%);
      max-width: 460px;
      width: calc(100% - 32px);
      display: flex;
      align-items: flex-start;
      gap: 10px;
      background: rgba(255, 247, 230, 0.98);
      border-radius: 18px;
      border: 2px solid #f5d3a6;
      box-shadow: 0 6px 18px rgba(0,0,0,0.35);
      padding: 10px 12px 12px;
      color: #4b3044;
      z-index: 30;
      animation: bearPop 0.4s ease-out;
    }
    .bear-dialog.hidden {
      display: none;
    }
    .bear-avatar {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #ffeaa7, #ff9f7b);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      flex-shrink: 0;
    }
    .bear-text {
      flex: 1;
      font-size: 13px;
    }
    .bear-title {
      font-weight: 700;
      margin-bottom: 4px;
      color: #8a4d5c;
    }
    .bear-message {
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 6px;
    }
    .bear-actions {
      text-align: right;
    }
    .bear-actions button {
      font-size: 12px;
      padding: 6px 14px;
      box-shadow: none;
    }
    @keyframes bearPop {
      from { transform: translate(-50%, 40px) scale(0.9); opacity: 0; }
      to   { transform: translate(-50%, 0) scale(1); opacity: 1; }
    }

    /* æ˜Ÿæ˜Ÿç²’å­å±¤ */
    .star-layer {
      pointer-events: none;
      position: absolute;
      inset: 0;
      overflow: hidden;
      z-index: -1;
    }
    .star {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 0 6px rgba(255,255,255,0.9);
      animation: starFloat 1.4s ease-out forwards;
      opacity: 0;
    }
    @keyframes starFloat {
      0% {
        transform: translate3d(0, 10px, 0) scale(0.3);
        opacity: 0;
      }
      20% {
        opacity: 1;
      }
      100% {
        transform: translate3d(0, -40px, 0) scale(1);
        opacity: 0;
      }
    }

    /* å°æç¤ºæ–‡å­— */
    .hint {
      text-align: center;
      font-size: 11px;
      color: #edd2f4;
      margin-top: 6px;
    }

    @media (max-width: 400px) {
      .card {
        width: 80px;
        height: 124px;
      }
    }
  </style>
</head>
<body>
  <div class="game-wrap">
    <!-- æ˜Ÿæ˜Ÿç²’å­å±¤ -->
    <div class="star-layer" id="starLayer"></div>

    <div class="card-panel">
      <h1>ç†Šç†Šå¡”ç¾…å åœ</h1>
      <div class="subtitle">æ·±å‘¼å¸ 3 ç§’ï¼Œå¿ƒè£¡é»˜å¿µå•é¡Œï¼Œç„¶å¾Œé»ä¸‹æŒ‰éˆ•ã€‚</div>
      <div class="star-divider">âœ¦ âœ¦ âœ¦</div>

      <div class="btn-bar">
        <button id="startBtn">é–‹å§‹å åœ</button>
      </div>

      <div class="table">
        <!-- éå» -->
        <div class="card-slot" data-position="past">
          <div class="slot-title">éå»</div>
          <div class="card">
            <div class="card-inner">
              <div class="card-face card-back">â˜…</div>
              <div class="card-face card-front">
                <div class="card-name"></div>
                <div class="card-tag"></div>
                <div class="card-meaning"></div>
                <div class="card-icon"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- ç¾åœ¨ -->
        <div class="card-slot" data-position="present">
          <div class="slot-title">ç¾åœ¨</div>
          <div class="card">
            <div class="card-inner">
              <div class="card-face card-back">â˜…</div>
              <div class="card-face card-front">
                <div class="card-name"></div>
                <div class="card-tag"></div>
                <div class="card-meaning"></div>
                <div class="card-icon"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- æœªä¾† -->
        <div class="card-slot" data-position="future">
          <div class="slot-title">æœªä¾†</div>
          <div class="card">
            <div class="card-inner">
              <div class="card-face card-back">â˜…</div>
              <div class="card-face card-front">
                <div class="card-name"></div>
                <div class="card-tag"></div>
                <div class="card-meaning"></div>
                <div class="card-icon"></div>
              </div>
            </div>
          </div>
        </div>
      </div><!-- .table -->
    </div><!-- .card-panel -->

    <div class="hint">æç¤ºï¼šæŒ‰ã€Œé–‹å§‹å åœã€å¾Œï¼Œä¾åºé»ä¸‰å¼µç‰Œç¿»é–‹å”· âœ¨</div>
  </div><!-- .game-wrap -->

  <!-- ç†Šç†Šå°è©±æ¡† -->
  <div id="bearDialog" class="bear-dialog hidden">
    <div class="bear-avatar">ğŸ»</div>
    <div class="bear-text">
      <div class="bear-title">æ‘é•·ç†Šç†Šçš„å°æé†’</div>
      <div class="bear-message" id="bearMessage">
        ä»Šå¤©çš„èƒ½é‡æ­£åœ¨æº–å‚™ä¸­â€¦
      </div>
      <div class="bear-actions">
        <button id="againBtn">å†å ä¸€æ¬¡</button>
      </div>
    </div>
  </div>

  <script>
    // ç°¡æ˜“å¡”ç¾…ç‰Œè³‡æ–™ï¼ˆå¯ä¹‹å¾Œå†æ“´å……æˆå®Œæ•´ç‰ˆï¼‰
    const tarotCards = [
      {
        name: "å¤ªé™½",
        tag: "æº«æš–ãƒ»è‡ªä¿¡ãƒ»æˆåŠŸ",
        icon: "â˜€ï¸",
        meaningPast: "éå»æ›¾æœ‰è®“ä½ ç™¼å…‰çš„æ™‚åˆ»ï¼Œé‚£äº›æˆåŠŸçš„è¨˜æ†¶å…¶å¯¦é‚„åœ¨æ”¯æŒè‘—ä½ ã€‚",
        meaningPresent: "ç¾åœ¨çš„ä½ ï¼Œæ¯”è‡ªå·±æƒ³åƒä¸­æ›´æœ‰åŠ›é‡ï¼Œåªæ˜¯é‚„æ²’å®Œå…¨ç›¸ä¿¡è‡ªå·±ã€‚",
        meaningFuture: "æœªä¾†æœƒè¿ä¾†ä¸€å€‹æ›´é©åˆå±•ç¾ä½ çš„èˆå°ï¼Œè«‹å¤§æ–¹åœ°ç«™ä¸Šå»ã€‚"
      },
      {
        name: "æœˆäº®",
        tag: "æƒ…ç·’ãƒ»ç›´è¦ºãƒ»ä¸å®‰",
        icon: "ğŸŒ™",
        meaningPast: "æ›¾ç¶“æœ‰ä¸€æ®µæ™‚é–“ï¼Œä½ å¸¸å¸¸çŒœæ¸¬åˆ¥äººçš„æƒ³æ³•ï¼Œä¹Ÿå®¹æ˜“æ‡·ç–‘è‡ªå·±ã€‚",
        meaningPresent: "ç¾åœ¨çš„ä½ å¾ˆæ•æ„Ÿï¼Œè«‹å…ˆç…§é¡§å¥½ç¡çœ èˆ‡æƒ…ç·’ï¼Œç›¸ä¿¡è‡ªå·±çš„ç›´è¦ºã€‚",
        meaningFuture: "æœªä¾†è¿·éœ§æœƒæ…¢æ…¢æ•£é–‹ï¼Œåªè¦ä¸€æ­¥ä¸€æ­¥å‰é€²ï¼Œç­”æ¡ˆè‡ªç„¶æœƒæµ®ç¾ã€‚"
      },
      {
        name: "æ„šè€…",
        tag: "æ–°çš„é–‹å§‹ãƒ»å‹‡æ°£",
        icon: "ğŸ’",
        meaningPast: "ä½ æ›¾ç¶“å‹‡æ•¢åšéä¸€äº›åˆ¥äººä¸å¤ªæ‡‚çš„é¸æ“‡ï¼Œé‚£æ˜¯å¾ˆçè²´çš„ç¶“é©—ã€‚",
        meaningPresent: "ç¾åœ¨å¾ˆé©åˆå­¸ç¿’æ–°æ±è¥¿ï¼Œå…è¨±è‡ªå·±åƒæ–°æ‰‹ä¸€æ¨£æ…¢æ…¢æ‘¸ç´¢ã€‚",
        meaningFuture: "å‰æ–¹æœ‰æ–°çš„æ—…ç¨‹åœ¨ç­‰ä½ ï¼Œå¸¶è‘—å¥½å¥‡å¿ƒå’Œä¸€é»é»å‚»å‹å°±è¶³å¤ ã€‚"
      },
      {
        name: "æˆ€äºº",
        tag: "é—œä¿‚ãƒ»é¸æ“‡ãƒ»é€£çµ",
        icon: "ğŸ’–",
        meaningPast: "éå»çš„é—œä¿‚è®“ä½ å­¸æœƒä»€éº¼æ˜¯å¿ƒå‹•ï¼Œä¹Ÿå­¸æœƒæ€éº¼ä¿è­·è‡ªå·±ã€‚",
        meaningPresent: "ç¾åœ¨çš„é—œä¿‚èª²é¡Œï¼Œæ­£åœ¨é‚€è«‹ä½ æ›´èª å¯¦åœ°è¡¨é”çœŸå¯¦çš„æ„Ÿå—ã€‚",
        meaningFuture: "åªè¦é¡˜æ„äº’ç›¸å‚¾è½ï¼Œæœªä¾†æœƒå‡ºç¾è®“ä½ æ„Ÿåˆ°è¢«ç†è§£ã€è¢«æ¥ä½çš„å¤¥ä¼´ã€‚"
      },
      {
        name: "éš±è€…",
        tag: "ç¨è™•ãƒ»æ€è€ƒãƒ»æ•´ç†",
        icon: "ğŸ•¯ï¸",
        meaningPast: "æ›¾ç¶“çš„ä½ éœ€è¦å¾ˆå¤šç¨è™•æ™‚é–“ï¼Œæ…¢æ…¢æ•´ç†å¿ƒè£¡çš„è¤‡é›œæ„Ÿå—ã€‚",
        meaningPresent: "ç¾åœ¨é©åˆæŠŠæ­¥èª¿æ”¾æ…¢ä¸€é»ï¼Œå…ˆé™ªè‡ªå·±å¥½å¥½æƒ³æ¸…æ¥šçœŸæ­£éœ€è¦çš„æ˜¯ä»€éº¼ã€‚",
        meaningFuture: "æœªä¾†çš„ä½ æœƒå¸¶è‘—ç¾åœ¨çš„æ€è€ƒçµæœï¼Œè®Šæˆä¸€ç¨®æˆç†Ÿçš„æ™ºæ…§ã€‚"
      },
      {
        name: "åŠ›é‡",
        tag: "æº«æŸ”çš„å …å®š",
        icon: "ğŸ¦",
        meaningPast: "éå»æœ‰äº›æŒ‘æˆ°å…¶å¯¦å·²ç¶“è­‰æ˜ï¼Œä½ æ¯”è‡ªå·±ä»¥ç‚ºçš„é‚„è¦å‹‡æ•¢ã€‚",
        meaningPresent: "ç¾åœ¨ä¸éœ€è¦å¤§å¼å¤§å«çš„åŠ›é‡ï¼Œåªè¦æº«æŸ”ä½†ä¸é€€è®“å°±å¾ˆå¥½ã€‚",
        meaningFuture: "æœªä¾†çš„ä½ èƒ½ç”¨æº«æš–èˆ‡ç©©å®šï¼Œå®‰æ’«åˆ¥äººçš„ä¸å®‰ï¼Œä¹Ÿæˆç‚ºè‡ªå·±çš„é å±±ã€‚"
      }
    ];

    const startBtn = document.getElementById("startBtn");
    const starLayer = document.getElementById("starLayer");
    const bearDialog = document.getElementById("bearDialog");
    const bearMessageEl = document.getElementById("bearMessage");
    const againBtn = document.getElementById("againBtn");

    const slots = {
      past:  document.querySelector('.card-slot[data-position="past"]  .card'),
      present: document.querySelector('.card-slot[data-position="present"] .card'),
      future: document.querySelector('.card-slot[data-position="future"] .card')
    };

    let reading = null;
    let flippedCount = 0;
    let gameReady = false;

    // å·¥å…·ï¼šæ´—ç‰Œ
    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // å·¥å…·ï¼šç”¢ç”Ÿæ˜Ÿæ˜Ÿç²’å­
    function spawnStarBurst(centerX, centerY, count = 8) {
      const rect = starLayer.getBoundingClientRect();
      for (let i = 0; i < count; i++) {
        const star = document.createElement("div");
        star.className = "star";
        const offsetX = (Math.random() - 0.5) * 40;
        const offsetY = (Math.random() - 0.5) * 10;
        star.style.left = (centerX - rect.left + offsetX) + "px";
        star.style.top  = (centerY - rect.top + offsetY) + "px";
        const delay = (Math.random() * 0.25).toFixed(2);
        star.style.animationDelay = delay + "s";
        starLayer.appendChild(star);
        star.addEventListener("animationend", () => {
          star.remove();
        });
      }
    }

    // å·¥å…·ï¼šè¨­å®šå–®å¼µå¡ç‰‡æ­£é¢æ–‡å­—
    function fillCard(cardEl, cardData, positionKey) {
      const nameEl    = cardEl.querySelector(".card-name");
      const tagEl     = cardEl.querySelector(".card-tag");
      const meaningEl = cardEl.querySelector(".card-meaning");
      const iconEl    = cardEl.querySelector(".card-icon");

      nameEl.textContent    = cardData.name;
      tagEl.textContent     = cardData.tag;
      iconEl.textContent    = cardData.icon;

      if (positionKey === "past") {
        meaningEl.textContent = cardData.meaningPast;
      } else if (positionKey === "present") {
        meaningEl.textContent = cardData.meaningPresent;
      } else {
        meaningEl.textContent = cardData.meaningFuture;
      }
    }

    // ç”Ÿæˆæ•´é«”è§£è®€ï¼Œçµ¦ç†Šç†Šèªª
    function buildBearMessage(reading) {
      const { past, present, future } = reading;
      return (
        `éå»çš„ä½ æŠ½åˆ°ã€Œ${past.name}ã€ï¼Œæé†’ä½ é‚£äº›ç¶“é©—å…¶å¯¦ä¸€ç›´åœ¨é™ªä½ é•·å¤§ã€‚\n` +
        `ç¾åœ¨çš„ä½ç½®æ˜¯ã€Œ${present.name}ã€ï¼Œç†Šç†Šè¦ºå¾—é€™æ˜¯ä½ ç¾åœ¨æœ€é‡è¦çš„ä¸»é¡Œã€‚\n` +
        `æœªä¾†å‰‡å‡ºç¾ã€Œ${future.name}ã€ï¼Œä»£è¡¨å‰æ–¹é‚„æœ‰æ–°çš„å¯èƒ½åœ¨ç­‰ä½ å˜—è©¦ã€‚\n\n` +
        `ğŸ» æ‘é•·ç†Šç†Šæƒ³èªªï¼šä¸ç®¡ç‰Œé¢æ€éº¼èªªï¼Œä½ éƒ½æœ‰æ¬Šåˆ©æ…¢æ…¢ä¾†ã€å¥½å¥½ç…§é¡§è‡ªå·±çš„å¿ƒã€‚`
      );
    }

    // é–‹å§‹ä¸€æ¬¡æ–°çš„å åœ
    function startReading() {
      // æ´—ç‰Œï¼Œå–å‰ä¸‰å¼µåšç‚ºéå»ï¼ç¾åœ¨ï¼æœªä¾†
      const shuffled = shuffle(tarotCards);
      reading = {
        past: shuffled[0],
        present: shuffled[1],
        future: shuffled[2]
      };
      flippedCount = 0;
      gameReady = true;

      // å°‡ä¸‰å¼µç‰Œå¾©åŸæˆèƒŒé¢ & å‡ºå ´å‹•ç•«
      Object.entries(slots).forEach(([key, cardEl], index) => {
        cardEl.classList.remove("flipped");
        cardEl.style.pointerEvents = "auto";
        cardEl.classList.remove("show"); // é‡æ–°è§¸ç™¼å‹•ç•«
        void cardEl.offsetWidth;        // å¼·åˆ¶å›æµä»¥ä¾¿é‡æ–°æ’­æ”¾å‹•ç•«
        cardEl.classList.add("show");
        fillCard(cardEl, reading[key], key);
      });

      // éš±è—ç†Šç†Šå°è©±
      bearDialog.classList.add("hidden");

      // æ˜Ÿæ˜Ÿå°å™´ç™¼
      const rect = startBtn.getBoundingClientRect();
      spawnStarBurst(rect.left + rect.width / 2, rect.top);

      // æŒ‰éˆ•é–å®šï¼Œé¿å…é€£æŒ‰
      startBtn.disabled = true;
      setTimeout(() => {
        startBtn.disabled = false;
      }, 1200);
    }

    // å¡ç‰‡é»æ“Šäº‹ä»¶
    function bindCardEvents() {
      Object.entries(slots).forEach(([key, cardEl]) => {
        cardEl.addEventListener("click", (e) => {
          if (!gameReady) return;
          if (cardEl.classList.contains("flipped")) return;

          cardEl.classList.add("flipped");
          flippedCount++;

          // åœ¨å¡ç‰‡é™„è¿‘å™´ç™¼æ˜Ÿæ˜Ÿ
          const rect = cardEl.getBoundingClientRect();
          spawnStarBurst(rect.left + rect.width / 2, rect.top + rect.height / 2, 10);

          if (flippedCount === 3) {
            // å…¨éƒ¨ç¿»å®Œï¼Œç¨å¾®å»¶é²ä¸€ä¸‹ï¼Œè®“ç¿»ç‰Œå‹•ç•«è·‘å®Œå†é¡¯ç¤ºç†Šç†Š
            setTimeout(() => {
              bearMessageEl.textContent = buildBearMessage(reading);
              bearDialog.classList.remove("hidden");
              gameReady = false;
            }, 600);
          }
        });
      });
    }

    // æŒ‰éˆ•ç¶å®š
    startBtn.addEventListener("click", () => {
      startReading();
    });

    againBtn.addEventListener("click", () => {
      startReading();
    });

    // åˆå§‹åŒ–
    bindCardEvents();
  </script>
</body>
</html>
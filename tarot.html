<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ç†Šç†Šå¡”ç¾…å åœ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.webmanifest">

  <!-- iOS ä¸»ç•«é¢ icon -->
  <link rel="apple-touch-icon" href="icons/bear-tarot-192.png">

  <!-- ä¸€èˆ¬ç€è¦½å™¨ favicon -->
  <link rel="icon" type="image/png" sizes="192x192" href="icons/bear-tarot-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/bear-tarot-512.png">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: "Noto Sans TC", -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(180deg, #2d254a, #6a4f9c, #f9e4c8);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .game-wrap {
      max-width: 480px;
      width: 100%;
      padding: 16px;
      margin-top: 16px;
      position: relative;
    }

    .card-panel {
      background: rgba(255, 247, 230, 0.96);
      border-radius: 18px;
      border: 2px solid #f7dba5;
      box-shadow: 0 4px 14px rgba(0,0,0,0.25);
      padding: 18px 14px 20px;
      color: #4a3450;
    }

    h1 {
      text-align: center;
      margin: 0 0 6px;
      font-size: 22px;
      letter-spacing: .15em;
    }

    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #7c5c88;
      margin-bottom: 10px;
    }

    .btn-bar {
      text-align: center;
      margin-bottom: 10px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 10px 22px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #ffcf5f, #ff9f7b);
      color: #4a2a18;
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      transition: transform .1s ease, box-shadow .1s ease, opacity .2s ease;
    }

    button:active {
      transform: translateY(1px) scale(.97);
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    }

    button:disabled {
      opacity: 0.6;
      box-shadow: none;
      cursor: default;
    }

    .table {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }

    .card-slot {
      flex: 1;
      text-align: center;
    }

    .slot-title {
      font-size: 13px;
      color: #8f6c9b;
      margin-bottom: 6px;
    }

    .card {
      width: 90px;
      height: 140px;
      cursor: pointer;
      opacity: 0;
      transform: translateY(20px) scale(.9);
      pointer-events: none;
      transition: transform .25s ease, opacity .25s ease;
      margin: 0 auto;
    }

    .card.show {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    .card-inner {
      width: 100%;
      height: 100%;
      position: relative;
    }

    .card-face {
      position: absolute;
      inset: 0;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 9px rgba(0,0,0,0.25);
    }

    .card-face img {
      width: 100%;
      height: 100%;
      display: block;
      object-fit: cover;
      border-radius: 12px;
    }

    /* â­ èƒŒé¢ / æ­£é¢åˆ‡æ› */
    .card-back {
      opacity: 1;
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
    .card-front {
      opacity: 0;
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
    .card.flipped .card-back {
      opacity: 0;
      transform: scale(0.96);
    }
    .card.flipped .card-front {
      opacity: 1;
      transform: scale(1.02);
    }

    /* çµæœé¢æ¿ */
    #resultPanel {
      display: none;
      margin-top: 14px;
      background: #fff7e6;
      border: 2px solid #f5d3a6;
      border-radius: 18px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.35);
      padding: 12px 14px 14px;
      color: #4b3044;
    }

    #historyBox {
      margin-top: 10px;
      border-top: 1px dashed #e4c8aa;
      padding-top: 6px;
      max-height: 160px;
      overflow-y: auto;
      font-size: 12px;
      display: none;
      color: #3e2420;
    }

    #historyBox pre {
      white-space: pre-line;
      margin: 4px 0 0;
    }

    .history-title {
      font-weight: 700;
      margin-bottom: 4px;
      color: #7b3430;
    }

    @media (max-width: 400px) {
      .card {
        width: 80px;
        height: 124px;
      }
    }

    /* ğŸ» å³ä¸Šè§’ï¼šç†Šç†Šå›å®¶æŒ‰éˆ• */
    .back-home-btn {
      position: fixed;
      top: 14px;
      right: 14px;

      display: inline-flex;
      align-items: center;
      gap: 6px;

      padding: 6px 10px;
      border-radius: 999px;

      background: rgba(255, 247, 230, 0.18);
      border: 1px solid rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(6px);

      color: #fff7f0;
      font-size: 11px;
      font-weight: 600;
      text-decoration: none;

      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      z-index: 20;
      transition: background .2s ease, transform .1s ease, box-shadow .1s ease;
    }

    .back-home-btn img {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      object-fit: cover;
      display: block;
    }

    .back-home-btn span {
      letter-spacing: .08em;
    }

    .back-home-btn:hover {
      background: rgba(255, 247, 230, 0.3);
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    @media (max-width: 480px) {
      .back-home-btn {
        top: 10px;
        right: 10px;
        padding: 5px 9px;
        font-size: 10px;
      }
      .back-home-btn img {
        width: 20px;
        height: 20px;
      }
    }
  </style>
</head>

<body>
  <!-- ğŸ¡ ç†Šç†Šå›å®¶æŒ‰éˆ• -->
  <a href="https://luckygbear-coder.github.io/HeroApp/index.html" class="back-home-btn">
    <img src="icons/bear-tarot-192.png" alt="ç†Šç†Šæ‘é•·">
    <span>å›å®¶</span>
  </a>

  <div class="game-wrap">
    <div class="card-panel">
      <h1>ç†Šç†Šå¡”ç¾…å åœ</h1>
      <div class="subtitle">æ·±å‘¼å¸ 3 ç§’ï¼Œåœ¨å¿ƒè£¡é»˜å¿µå•é¡Œï¼Œå†é»ä¸‹æŒ‰éˆ•ã€‚</div>

      <div class="btn-bar">
        <button id="startBtn">ğŸ”® é–‹å§‹å åœ</button>
      </div>

      <div class="table">
        <div class="card-slot" data-position="past">
          <div class="slot-title">éå»</div>
          <div class="card">
            <div class="card-inner"></div>
          </div>
        </div>
        <div class="card-slot" data-position="present">
          <div class="slot-title">ç¾åœ¨</div>
          <div class="card">
            <div class="card-inner"></div>
          </div>
        </div>
        <div class="card-slot" data-position="future">
          <div class="slot-title">æœªä¾†</div>
          <div class="card">
            <div class="card-inner"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- çµæœ -->
    <div id="resultPanel">
      <div style="font-weight:700; color:#8a4d5c; margin-bottom:6px;">
        ğŸ» æ‘é•·ç†Šç†Šçš„å°æé†’
      </div>
      <div id="resultText" style="white-space:pre-line;">
        ä»Šå¤©çš„èƒ½é‡æ­£åœ¨æº–å‚™ä¸­â€¦
      </div>

      <div style="display:flex; gap:8px; margin-top:10px;">
        <button id="againBtn">å†å ä¸€æ¬¡</button>
        <button id="toggleHistoryBtn">æŠ½ç‰Œç´€éŒ„</button>
        <button id="downloadBtn">ä¸‹è¼‰æ–‡å­—</button>
      </div>

      <div id="historyBox"></div>
    </div>
  </div>

  <script>
    /* ==================== Tarot å…¨éƒ¨ 22 å¼µ ==================== */
    const tarotCards = [
      { id: 0, name: "æ„šè€…", icon: "ğŸ’",
        upright: { meaning:"æ–°çš„æ—…ç¨‹ã€å‹‡æ•¢å˜—è©¦ã€å¸¶è‘—å¥½å¥‡å¿ƒå¾€å‰èµ°ï¼Œå…è¨±è‡ªå·±ç•¶æ–°æ‰‹ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šå°±ç®—ä¸çŸ¥é“æœƒç™¼ç”Ÿä»€éº¼ä¹Ÿæ²’é—œä¿‚ã€‚ä½ é¡˜æ„è¸å‡ºå»çš„é‚£ä¸€æ­¥ï¼Œå°±æ˜¯æœ€å²å®³çš„å‹‡æ°£ï¼" },
        reversed:{ meaning:"è¡å‹•æˆ–é€ƒé¿ï¼Œæé†’ä½ åœ¨å†’éšªå‰å…ˆåšå¥½åŸºæœ¬æº–å‚™ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šåœä¸€ä¸‹æ²’é—œä¿‚ï¼Œæˆ‘åœ¨é€™è£¡é™ªä½ ã€‚æº–å‚™å¥½äº†å†èµ°ï¼Œä¹Ÿæ˜¯ä¸€ç¨®å¾ˆæ£’çš„å‹‡æ•¢å–”ã€‚" }
      },
      { id: 1, name: "é­”è¡“å¸«", icon: "âœ¨",
        upright: { meaning:"ä½ å·²ç¶“æœ‰è¶³å¤ èƒ½åŠ›ï¼Œå¯ä»¥é–‹å§‹å¯¦ç¾æƒ³æ³•ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ çš„é»å­çœŸçš„å¾ˆæ£’ï¼ç¾åœ¨å°±æ˜¯æœ€é©åˆé–‹å§‹è¡Œå‹•çš„æ™‚é–“ï½" },
        reversed:{ meaning:"å¿ƒæ€æ•£äº‚ã€å°ˆæ³¨åŠ›ä¸è¶³ï¼Œéœ€è¦å›åˆ°æ ¸å¿ƒç›®æ¨™ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šå…ˆæŠŠè…¦è¢‹çš„å°é›œéŸ³é—œèµ·ä¾†å§ã€‚å°ˆæ³¨ä¸€ä»¶äº‹ï¼Œä½ æœƒæ›´è¼•é¬†ï¼Œä¹Ÿæ›´æœ‰åŠ›é‡ã€‚" }
      },
      { id: 2, name: "å¥³ç¥­å¸", icon: "ğŸŒ™",
        upright: { meaning:"å®‰éœä¸‹ä¾†ï¼Œç›´è¦ºæœƒçµ¦ä½ ç­”æ¡ˆã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ å¿ƒè£¡å…¶å¯¦æ—©å°±çŸ¥é“ç­”æ¡ˆäº†ã€‚æˆ‘æœƒé™ªä½ ä¸€èµ·è½è½é‚£å€‹æŸ”è»Ÿçš„è²éŸ³ã€‚" },
        reversed:{ meaning:"æƒ…ç·’æ··äº‚ã€æ€ç·’é‡ç–Šï¼Œéœ€è¦ä¼‘æ¯ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šæ²’é—œä¿‚ï¼Œæˆ‘å€‘å…ˆåœä¸€ä¸‹ã€‚ä½ å€¼å¾—ä¸€å€‹å®‰éœçš„ç©ºé–“ï¼Œè®“å¿ƒæ…¢æ…¢å¹³éœä¸‹ä¾†ã€‚" }
      },
      { id: 3, name: "çš‡å", icon: "ğŸ‘‘",
        upright: { meaning:"é©åˆç…§é¡§è‡ªå·±ã€äº«å—ç”Ÿæ´»ã€å‰µé€ ç¾ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ å€¼å¾—è¢«å¥½å¥½å‘µè­·ã€‚å¶çˆ¾å°è‡ªå·±æº«æŸ”ä¸€é»ï¼Œæ˜¯å¾ˆé‡è¦çš„å–”ã€‚" },
        reversed:{ meaning:"éåº¦ä»˜å‡ºã€å¿½ç•¥è‡ªå·±ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ å·²ç¶“å¾ˆåŠªåŠ›äº†ï¼Œæ›ä½ ä¼‘æ¯ä¸€ä¸‹å§ã€‚æˆ‘æœƒæé†’ä½ ï¼ŒæŠŠæ„›åˆ†ä¸€äº›çµ¦è‡ªå·±ã€‚" }
      },
      { id: 4, name: "çš‡å¸", icon: "ğŸ›ï¸",
        upright: { meaning:"éœ€è¦åˆ¶å®šç•Œç·šã€å»ºç«‹ç§©åºã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šç«™ç›´ã€æŠ¬é ­ï¼Œä½ å…¶å¯¦æ¯”è‡ªå·±æƒ³åƒå¾—æ›´èƒ½æŒæ§å±€é¢ã€‚" },
        reversed:{ meaning:"å¤ªåƒµç¡¬æˆ–å¤ªæ§åˆ¶ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šæŸ”è»Ÿä¸€é»é»ï¼Œä¸æœƒè®“ä½ è®Šå¼±ã€‚åè€Œèƒ½è®“ä½ å‘¼å¸å¾—æ›´è¼•é¬†ã€‚" }
      },
      { id: 5, name: "æ•™çš‡", icon: "ğŸ“–",
        upright: { meaning:"é©åˆè«‹æ•™å°ˆæ¥­ã€æŒ‰éƒ¨å°±ç­ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ ä¸æ˜¯ä¸€å€‹äººï¼Œæœ‰å¯ä¿¡ä»»çš„äººé¡˜æ„æ•™ä½ ã€é™ªä½ ã€‚" },
        reversed:{ meaning:"ä¸æƒ³è¢«è¦å‰‡ç¶ä½ï¼Œæ¸´æœ›è‡ªç”±ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ å¯ä»¥å‰µé€ è‡ªå·±çš„æ–¹å¼ã€‚åªè¦å°è‡ªå·±èª å¯¦ï¼Œå°±èƒ½èµ°å‡ºä¸€æ¢æ–°çš„è·¯ã€‚" }
      },
      { id: 6, name: "æˆ€äºº", icon: "ğŸ’–",
        upright: { meaning:"çœŸèª é€£çµã€é‡è¦é¸æ“‡ä¾†è‡¨ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šæŠŠä½ çš„å¿ƒèªªå‡ºä¾†å§ã€‚çœŸæ­£é‡è¦çš„é€£çµï¼Œéƒ½ä¾†è‡ªçœŸèª ã€‚" },
        reversed:{ meaning:"èª¤è§£ã€çŒ¶è±«ã€é—œä¿‚ä¸å¹³è¡¡ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šåˆ¥æ€¥è‘—åšæ±ºå®šã€‚å…ˆè½è½è‡ªå·±å¿ƒè£¡çœŸæ­£çš„æ„Ÿå—ã€‚" }
      },
      { id: 7, name: "æˆ°è»Š", icon: "ğŸ‡",
        upright: { meaning:"å‰é€²ã€æˆ°å‹å›°é›£ã€æŒæ§æ–¹å‘ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šæˆ‘çœ‹åˆ°ä½ å¾ˆåŠªåŠ›ï¼ç¹¼çºŒå¾€å‰ï¼Œä½ çœŸçš„åšå¾—åˆ°ï¼" },
        reversed:{ meaning:"æ–¹å‘ä¸æ˜ã€å¤ªæ€¥èºã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šå…ˆæ…¢ä¸€é»ï¼Œä¸æ˜¯é€€æ­¥ï¼Œè€Œæ˜¯è®“ä½ æ›´æ¸…æ¥šè¦å¾€å“ªè£¡å»ã€‚" }
      },
      { id: 8, name: "åŠ›é‡", icon: "ğŸ¦",
        upright: { meaning:"æº«æŸ”ä¹Ÿèƒ½å¾ˆæœ‰åŠ›é‡ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ ä¸éœ€è¦å¼·è£å …å¼·ï¼Œä½ æœ¬ä¾†å°±å·²ç¶“å¾ˆå‹‡æ•¢äº†ã€‚" },
        reversed:{ meaning:"ç–²ç´¯ã€è‡ªæˆ‘æ‡·ç–‘ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä¼‘æ¯ä¸æ˜¯å¤±æ•—ã€‚ä½ å€¼å¾—è¢«æŠ±ä¸€æŠ±ã€å¥½å¥½å……é›»ã€‚" }
      },
      { id: 9, name: "éš±è€…", icon: "ğŸ•¯ï¸",
        upright: { meaning:"ä¸€å€‹äººçš„æ™‚é–“èƒ½å¸¶ä¾†ç­”æ¡ˆã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ ä¸ç”¨æ€¥è‘—å›ç­”ä¸–ç•Œï¼Œå…ˆé™ªé™ªè‡ªå·±ä¹Ÿå¾ˆå¥½ã€‚" },
        reversed:{ meaning:"å­¤å–®ã€å°é–‰å¤ªä¹…ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šå¦‚æœé¡˜æ„ï¼Œæˆ‘åœ¨é€™è£¡ï¼Œå¯ä»¥é™ªä½ æ…¢æ…¢èµ°å‡ºå»ã€‚" }
      },
      { id: 10, name: "å‘½é‹ä¹‹è¼ª", icon: "ğŸ¡",
        upright: { meaning:"å¥½é‹è½‰å‹•ã€æ–°æ©Ÿæœƒå³å°‡ä¾†è‡¨ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šæ¨ä¸€ä¸‹ä½ çš„å‘½é‹ä¹‹è¼ªå§ï¼æ©Ÿæœƒæ­£åœ¨é è¿‘ä½ ï½" },
        reversed:{ meaning:"äº‹æƒ…åœæ»¯ã€æ™‚æ©Ÿæœªåˆ°ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šåˆ¥å¿ƒæ€¥ï¼Œä½ è¦çš„æ±è¥¿æ²’æœ‰æ¶ˆå¤±ï¼Œåªæ˜¯æ­£åœ¨æº–å‚™æ›´å¥½çš„ç‰ˆæœ¬çµ¦ä½ ã€‚" }
      },
      { id: 11, name: "æ­£ç¾©", icon: "âš–ï¸",
        upright: { meaning:"éœ€è¦ç†æ€§ã€é¢å°çœŸç›¸ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šèªªçœŸè©±éœ€è¦å‹‡æ°£ï¼Œè€Œä½ è¾¦å¾—åˆ°ã€‚" },
        reversed:{ meaning:"æ„Ÿåˆ°ä¸å…¬å¹³ã€èª¤æœƒã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šå…ˆæŠŠå¿ƒå®‰æ’«å¥½ï¼Œå†ä¾†è«‡ä»€éº¼æ˜¯å…¬å¹³ã€‚ä½ å€¼å¾—è¢«ç†è§£ã€‚" }
      },
      { id: 12, name: "åŠäºº", icon: "ğŸªœ",
        upright: { meaning:"åœä¸‹è…³æ­¥æ‰èƒ½çœ‹è¦‹æ–°æ–¹å‘ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šæœ‰æ™‚å€™æ…¢ä¸‹ä¾†ï¼Œä¸æ˜¯è½å¾Œï¼Œè€Œæ˜¯è®“å¥‡è¹Ÿè¿½ä¸Šä½ ã€‚" },
        reversed:{ meaning:"åœæ»¯å¤ªä¹…ã€æŠ—æ‹’æ”¹è®Šã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ ä¸éœ€è¦ä¸€æ¬¡æ”¹è®Šå…¨éƒ¨ï¼Œå¾å°åœ°æ–¹é–‹å§‹å°±å¾ˆå¥½ã€‚" }
      },
      { id: 13, name: "æ­»ç¥", icon: "â˜ ï¸",
        upright: { meaning:"ä¸€æ®µé—œä¿‚æˆ–éšæ®µçµæŸï¼Œè¿å‘é‡ç”Ÿã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šæŠŠèˆŠçš„æ”¾ä¸‹ï¼Œä½ çš„æ‰‹æ‰èƒ½æ¥ä½æ–°çš„ç¦®ç‰©ã€‚" },
        reversed:{ meaning:"å®³æ€•æ”¹è®Šã€åœæ»¯ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šæ…¢æ…¢ä¾†ï¼Œä½ ä¸å¿…ä¸€æ¬¡æ”¾æ‰‹ï¼Œæˆ‘æœƒé™ªè‘—ä½ ã€‚" }
      },
      { id: 14, name: "ç¯€åˆ¶", icon: "ğŸ’§",
        upright: { meaning:"æ‰¾åˆ°æœ€é©åˆè‡ªå·±çš„ç¯€å¥ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä¸ç”¨æ€¥ã€ä¸ç”¨è¡ï¼Œåªè¦ç©©ç©©åœ°ã€èˆ’æœåœ°å¾€å‰å°±å¾ˆå¥½ã€‚" },
        reversed:{ meaning:"å¤±è¡¡ã€éåº¦å¿™ç¢Œæˆ–æ”¾ç¸±ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä¼‘æ¯ä¸æ˜¯æµªè²»ï¼Œæ˜¯è®“ä½ æ›´é †åˆ©çš„ç§˜å¯†æ­¦å™¨ã€‚" }
      },
      { id: 15, name: "æƒ¡é­”", icon: "ğŸ˜ˆ",
        upright: { meaning:"çœ‹è¦‹è‡ªå·±è¢«ä»€éº¼ç¶ä½ï¼Œæ˜¯è§£è„«çš„ç¬¬ä¸€æ­¥ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šæ²’é—œä¿‚ï¼Œæˆ‘é™ªä½ ä¸€èµ·çœ‹çœ‹é‚£äº›è®“ä½ ä¸èˆ’æœçš„åœ°æ–¹ã€‚ä½ æ¯”å®ƒå€‘å¼·å¤§ã€‚" },
        reversed:{ meaning:"æœ‰æ©Ÿæœƒè„«é›¢è² é¢ç¿’æ…£ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šå¤ªå¥½äº†ï¼ä½ å·²ç¶“é–‹å§‹é¬†é–‹ç¹©å­äº†ï¼Œå†ä¸€æ­¥ä¸€æ­¥å°±èƒ½è‡ªç”±äº†ã€‚" }
      },
      { id: 16, name: "é«˜å¡”", icon: "ğŸ°",
        upright: { meaning:"èˆŠçš„çµæ§‹å´©è§£ï¼Œè¿ä¾†é‡å»ºæ©Ÿæœƒã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šé›–ç„¶çœ‹èµ·ä¾†å¯æ€•ï¼Œä½†é€™ä¸€æ­¥èƒ½è®“ä½ å¾—åˆ°çœŸæ­£é©åˆè‡ªå·±çš„ç”Ÿæ´»ã€‚" },
        reversed:{ meaning:"å®³æ€•å´©å£ã€æ‹’çµ•é¢å°ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šæ²’é—œä¿‚ï¼Œä½ å¯ä»¥æ…¢æ…¢ä¾†ã€‚åªè¦é¡˜æ„è·¨å‡ºä¸€å°æ­¥ï¼Œå°±æ˜¯é€²æ­¥ã€‚" }
      },
      { id: 17, name: "æ˜Ÿæ˜Ÿ", icon: "â­",
        upright: { meaning:"å¸Œæœ›ã€ç™‚ç™’ã€é¡˜æœ›ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ å€¼å¾—æº«æŸ”ï¼Œä¹Ÿå€¼å¾—è¢«å…‰ç…§äº®ã€‚æœªä¾†æ­£åœ¨è®Šå¥½ã€‚" },
        reversed:{ meaning:"æš«æ™‚å¤±å»æ–¹å‘ã€ç–²ç´¯ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šæ²’é—œä¿‚ï¼Œå…ˆä¼‘æ¯ä¸€ä¸‹ï¼Œæ˜Ÿæ˜Ÿæœƒåœ¨å¤œè£¡ç­‰ä½ ã€‚" }
      },
      { id: 18, name: "æœˆäº®", icon: "ğŸŒ™",
        upright: { meaning:"æƒ…ç·’èµ·ä¼ã€æ•æ„Ÿã€æ½›æ„è­˜è¨Šæ¯ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ çš„æ„Ÿå—å¾ˆé‡è¦ï¼Œè«‹ä¸è¦å¿½ç•¥å®ƒå€‘ã€‚" },
        reversed:{ meaning:"å®³æ€•ã€æƒ³åƒèˆ‡ç¾å¯¦æ··é›œã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šè©¦è‘—åšä¸€ä»¶å¾ˆå°å¾ˆç°¡å–®çš„äº‹ï¼Œä½ æœƒæ…¢æ…¢æ‰¾å›ç©©å®šã€‚" }
      },
      { id: 19, name: "å¤ªé™½", icon: "â˜€ï¸",
        upright: { meaning:"èƒ½é‡å……è¶³ã€å–œæ‚…ã€æˆåŠŸã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ çœŸçš„å¾ˆæ£’ï¼ä¸–ç•Œæ­£åœ¨ç‚ºä½ æ‹æ‰‹å–”ï½" },
        reversed:{ meaning:"ç–²ç´¯ã€å…§åœ¨å…‰è®Šå¼±ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ ä¸éœ€è¦ä¸€ç›´ç™¼å…‰ã€‚ç´¯äº†å°±ä¾†ç†Šç†Šé€™è£¡å……é›»ã€‚" }
      },
      { id: 20, name: "å¯©åˆ¤", icon: "ğŸ“£",
        upright: { meaning:"æ–°çš„å‘¼å–šã€ç¬¬äºŒæ¬¡æ©Ÿæœƒã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ æ¯”ä»¥å‰æ›´æˆç†Ÿäº†ï¼Œé€™ä¸€æ¬¡ä½ æœƒåšå¾—æ›´å¥½ã€‚" },
        reversed:{ meaning:"ç³¾çµã€ç„¡æ³•æ”¾ä¸‹éå»ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šä½ å·²ç¶“ç›¡åŠ›äº†ï¼Œå¯ä»¥æº«æŸ”åœ°æ”¾éè‡ªå·±ã€‚" }
      },
      { id: 21, name: "ä¸–ç•Œ", icon: "ğŸŒ",
        upright: { meaning:"ä¸€å€‹éšæ®µå³å°‡å®Œæˆï¼Œè¿å‘ä¸‹ä¸€æ—…ç¨‹ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šæ­å–œä½ ï¼ä½ åšå¾—å¾ˆæ£’ï¼Œæ–°çš„ç¯‡ç« æ­£åœ¨ç­‰ä½ ã€‚" },
        reversed:{ meaning:"å¿«å®Œæˆä½†å·®æœ€å¾Œä¸€æ­¥ã€‚",
                   bear:"ğŸ» ç†Šç†Šèªªï¼šå†å¤šä¸€é»é»åŠªåŠ›ï¼Œä½ å°±æœƒçœ‹åˆ°å¾ˆç¾çš„çµæœã€‚" }
      }
    ];

    function shuffle(arr){
      return [...arr].sort(()=>Math.random()-0.5);
    }

    const HISTORY_KEY = "bearTarotHistoryV1";
    let historyList = [];

    const startBtn         = document.getElementById("startBtn");
    const againBtn         = document.getElementById("againBtn");
    const toggleHistoryBtn = document.getElementById("toggleHistoryBtn");
    const downloadBtn      = document.getElementById("downloadBtn");
    const resultPanel      = document.getElementById("resultPanel");
    const resultText       = document.getElementById("resultText");
    const historyBox       = document.getElementById("historyBox");

    const cardSlots = {
      past   : document.querySelector('.card-slot[data-position="past"] .card'),
      present: document.querySelector('.card-slot[data-position="present"] .card'),
      future : document.querySelector('.card-slot[data-position="future"] .card')
    };

    function loadHistory(){
      try{
        const raw = localStorage.getItem(HISTORY_KEY);
        if(raw){
          const parsed = JSON.parse(raw);
          if(Array.isArray(parsed)) historyList = parsed;
        }
      }catch(e){}
    }

    function saveHistory(){
      localStorage.setItem(HISTORY_KEY, JSON.stringify(historyList));
    }

    function updateHistoryBox(){
      if(!historyList.length){
        historyBox.innerHTML =
          '<div style="color:#a88c93;">ç›®å‰é‚„æ²’æœ‰ç´€éŒ„å–”ï½å…ˆå®Œæˆä¸€æ¬¡å åœçœ‹çœ‹ã€‚</div>';
        return;
      }
      historyBox.innerHTML = historyList.map((item,idx)=>`
        <div style="margin-bottom:14px;">
          <div class="history-title">
            ç¬¬ ${idx+1} æ¬¡å åœï¼ˆ${item.time}ï¼‰
          </div>
          <pre>${item.text}</pre>
        </div>
      `).join("");
    }

    function setupCardImage(key,data){
      const card  = cardSlots[key];
      const inner = card.querySelector(".card-inner");

      card.classList.remove("flipped","show");
      inner.innerHTML = `
        <div class="card-face card-back">
          <img src="images/back.png" alt="card back">
        </div>
        <div class="card-face card-front">
          <img src="images/${data.card.id}.png" alt="${data.card.name}">
        </div>
      `;
      requestAnimationFrame(()=>card.classList.add("show"));
    }

    function buildBearMessage(r){
      function part(label,obj){
        const pos  = obj.reversed ? "ï¼ˆé€†ä½ï¼‰" : "ï¼ˆæ­£ä½ï¼‰";
        const side = obj.reversed ? obj.card.reversed : obj.card.upright;
        return `ã€${label}ã€‘${obj.card.icon} ${obj.card.name}${pos}\n${side.meaning}\n${side.bear}\n`;
      }
      return [
        "âœ¨ ç†Šç†Šç‚ºä½ æŠ½åˆ°çš„ä¸‰å¼µç‰Œï¼š",
        part("éå»ï¼èƒŒæ™¯", r.past),
        part("ç¾åœ¨ï¼æ­¤åˆ»", r.present),
        part("æœªä¾†ï¼èµ°å‘", r.future),
        "ğŸ§¸ å°æé†’ï¼šä»¥ä¸Šæ˜¯æº«æŸ”çš„å°å»ºè­°ï¼ŒçœŸæ­£æœ€é‡è¦çš„ï¼Œæ°¸é æ˜¯ä½ è‡ªå·±çš„æ„Ÿå—å–”ã€‚"
      ].join("\n\n");
    }

    let reading = null;
    let flippedCount = 0;

    function startReading(){
      flippedCount = 0;
      resultPanel.style.display = "none";
      historyBox.style.display = "none";

      const arr = shuffle(tarotCards);
      reading = {
        past   : { card: arr[0], reversed: Math.random()<0.5 },
        present: { card: arr[1], reversed: Math.random()<0.5 },
        future : { card: arr[2], reversed: Math.random()<0.5 }
      };

      setupCardImage("past", reading.past);
      setupCardImage("present", reading.present);
      setupCardImage("future", reading.future);
    }

    Object.entries(cardSlots).forEach(([key,card])=>{
      card.addEventListener("click",()=>{
        if(!reading) return;
        if(card.classList.contains("flipped")) return;

        card.classList.add("flipped");
        flippedCount++;

        if(flippedCount === 3){
          setTimeout(()=>{
            const msg = buildBearMessage(reading);
            resultText.textContent = msg;
            resultPanel.style.display = "block";

            const now = new Date();
            const timeLabel = now.toLocaleString("zh-TW",{
              month:"2-digit", day:"2-digit", hour:"2-digit", minute:"2-digit"
            });

            historyList.unshift({time:timeLabel,text:msg});
            saveHistory();
            updateHistoryBox();
          },600);
        }
      });
    });

    startBtn.addEventListener("click", startReading);
    againBtn.addEventListener("click", startReading);

    toggleHistoryBtn.addEventListener("click",()=>{
      historyBox.style.display =
        (historyBox.style.display === "none" || historyBox.style.display === "")
        ? "block" : "none";
    });

    downloadBtn.addEventListener("click",()=>{
      const text = resultText.textContent || "";
      const blob = new Blob([text],{type:"text/plain;charset=utf-8"});
      const url  = URL.createObjectURL(blob);
      const a    = document.createElement("a");
      a.href = url;
      a.download = "ä»Šæ—¥ç†Šç†Šå åœ.txt";
      a.click();
      URL.revokeObjectURL(url);
    });

    loadHistory();
    updateHistoryBox();
  </script>
</body>
</html>
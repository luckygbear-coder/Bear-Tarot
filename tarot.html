<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ç†Šç†Šå¡”ç¾…å åœ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
  /* ç†Šç†Šçµæœå¤§å¡ç‰‡ï¼ˆä¸æ“‹ä½ç‰Œï¼‰ */
.result-panel {
  margin-top: 14px;
  background: #fff7e6;                     /* è·Ÿä¹‹å‰ä¸€æ¨£çš„å¥¶æ²¹è‰²å¡ç‰‡ */
  border-radius: 18px;
  border: 2px solid #f5d3a6;
  box-shadow: 0 6px 18px rgba(0,0,0,0.35);
  padding: 12px 14px 14px;
}

/* ç†Šç†Šæ–‡å­—ï¼šé¡è‰²åŠ æ·±ã€è¡Œè·åŠ å¤§ã€ä¿ç•™æ›è¡Œ */
.result-panel-content {
  font-size: 13px;
  line-height: 1.6;
  color: #4b3044;                          /* æ¯”ä¹‹å‰æ›´æ·±ä¸€é» */
  white-space: pre-line;                   /* \n æœƒè®ŠæˆçœŸæ­£çš„æ›è¡Œ */
}
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: "Noto Sans TC", -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(180deg, #2d254a, #6a4f9c, #f9e4c8);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .game-wrap {
      max-width: 480px;
      width: 100%;
      padding: 16px;
      margin-top: 16px;
      position: relative;
      overflow: hidden;
    }
    .card-panel {
      background: rgba(255, 247, 230, 0.95);
      border-radius: 18px;
      border: 2px solid #f7dba5;
      box-shadow: 0 4px 14px rgba(0,0,0,0.25);
      padding: 18px 14px 20px;
      color: #4a3450;
    }
    h1 {
      margin: 0 0 4px;
      font-size: 22px;
      text-align: center;
      letter-spacing: 0.15em;
    }
    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #7c5c88;
      margin-bottom: 12px;
    }
    .star-divider {
      text-align: center;
      font-size: 16px;
      margin-bottom: 10px;
    }
    .btn-bar {
      text-align: center;
      margin-bottom: 10px;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 10px 22px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #ffcf5f, #ff9f7b);
      color: #4a2a18;
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.2s ease;
    }
    button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    /* ä¸‰å¼µç‰Œå€åŸŸ */
    .table {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }
    .slot-title {
      text-align: center;
      font-size: 12px;
      color: #8f6c9b;
      margin-bottom: 4px;
    }
    .card-slot {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* å¡ç‰‡æœ¬é«” */
    .card {
      width: 90px;
      height: 140px;
      perspective: 900px;
      cursor: pointer;
      opacity: 0;
      transform: translateY(20px) scale(0.9);
      pointer-events: none;
      transition: transform 0.2s ease;
    }
    .card.show {
      animation: cardEnter 0.45s forwards;
    }
    .card-inner {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s ease;
    }
    /* æ­£ä½ï¼šå¾€ä¸€é‚Šç¿» */
    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }
    /* é€†ä½ï¼šå¾€å¦ä¸€é‚Šç¿»ï¼ˆåæ–¹å‘æ—‹è½‰ï¼‰ */
    .card.is-reversed.flipped .card-inner {
      transform: rotateY(-180deg);
    }
    .card-face {
      position: absolute;
      inset: 0;
      border-radius: 12px;
      backface-visibility: hidden;
      box-shadow: 0 4px 9px rgba(0,0,0,0.25);
    }
    .card-back {
      background: radial-gradient(circle at 30% 20%, #ffeaa7, #f0932b, #e056fd);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      color: #fffdf0;
      border: 2px solid rgba(255,255,255,0.85);
      position: relative;
      overflow: hidden;
    }
    .card-back::before {
      content: "â˜…";
      position: absolute;
      font-size: 48px;
      opacity: 0.2;
      top: -8px;
      right: 8px;
    }
    .card-front {
      transform: rotateY(180deg);
      background: #fff9ef;
      border: 2px solid #f3c79b;
      padding: 10px 7px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    /* é€†ä½ï¼šé‚Šæ¡†é¡è‰²ç•¥æœ‰ä¸åŒï¼‹å¾®å¾®æ­ªæ–œæ„Ÿ */
    .card.is-reversed .card-front {
      border-color: #b895f5;
    }
    .card.is-reversed {
      transform: translateY(20px) scale(0.9) rotateZ(-2deg);
    }
    .card.show.card.is-reversed {
      animation: cardEnterReversed 0.45s forwards;
    }

    .card-name {
      font-size: 13px;
      font-weight: 700;
      text-align: center;
      color: #7a3f5f;
      margin-bottom: 4px;
    }
    .card-tag {
      font-size: 11px;
      text-align: center;
      color: #c77a68;
      margin-bottom: 6px;
    }
    .card-meaning {
      font-size: 11px;
      line-height: 1.4;
      color: #5c3b4c;
      flex: 1;
    }
    .card-icon {
      text-align: center;
      font-size: 18px;
      margin-top: 4px;
    }

    @keyframes cardEnter {
      from { opacity: 0; transform: translateY(20px) scale(0.9); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }
    @keyframes cardEnterReversed {
      from { opacity: 0; transform: translateY(20px) scale(0.9) rotateZ(-5deg); }
      to   { opacity: 1; transform: translateY(0) scale(1) rotateZ(-2deg); }
    }

    /* ç†Šç†Šå°è©±æ¡† */
    .bear-dialog {
      position: fixed;
      left: 50%;
      bottom: 8%;
      transform: translateX(-50%);
      max-width: 460px;
      width: calc(100% - 32px);
      display: flex;
      align-items: flex-start;
      gap: 10px;
      background: rgba(255, 247, 230, 0.98);
      border-radius: 18px;
      border: 2px solid #f5d3a6;
      box-shadow: 0 6px 18px rgba(0,0,0,0.35);
      padding: 10px 12px 12px;
      color: #4b3044;
      z-index: 30;
      animation: bearPop 0.4s ease-out;
    }
    .bear-dialog.hidden { display: none; }
    .bear-avatar {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #ffeaa7, #ff9f7b);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      flex-shrink: 0;
    }
    .bear-text { flex: 1; font-size: 13px; }
    .bear-title {
      font-weight: 700;
      margin-bottom: 4px;
      color: #8a4d5c;
    }
    .bear-message {
      font-size: 13px;
      line-height: 1.5;
      white-space: pre-line;
      margin-bottom: 6px;
    }
    .bear-actions { text-align: right; }
    .bear-actions button {
      font-size: 12px;
      padding: 6px 14px;
      box-shadow: none;
    }
    @keyframes bearPop {
      from { transform: translate(-50%, 40px) scale(0.9); opacity: 0; }
      to   { transform: translate(-50%, 0) scale(1); opacity: 1; }
    }

    /* æ˜Ÿæ˜Ÿç²’å­å±¤ */
    .star-layer {
      pointer-events: none;
      position: absolute;
      inset: 0;
      overflow: hidden;
      z-index: -1;
    }
    .star {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 0 6px rgba(255,255,255,0.9);
      animation: starFloat 1.4s ease-out forwards;
      opacity: 0;
    }
    @keyframes starFloat {
      0% {
        transform: translate3d(0, 10px, 0) scale(0.3);
        opacity: 0;
      }
      20% { opacity: 1; }
      100% {
        transform: translate3d(0, -40px, 0) scale(1);
        opacity: 0;
      }
    }

    .hint {
      text-align: center;
      font-size: 11px;
      color: #edd2f4;
      margin-top: 6px;
    }

    @media (max-width: 400px) {
      /* æŠ½ç‰Œç´€éŒ„çš„å¯è¦–åŒ–å¼·åŒ–ï¼ˆæ‰‹æ©Ÿ + æ¡Œæ©Ÿéƒ½åƒå¾—åˆ°ï¼‰ */
#historyBox {
  color: #4b3044;      /* èˆ‡ä¸Šé¢ç†Šç†Šæé†’åŒè‰²ç³» */
  font-size: 13px;
  line-height: 1.6;
}

#historyBox pre {
  color: #4b3044;      /* è®“å…§å®¹è®Šæ¸…æ¥š */
  font-size: 13px;
  line-height: 1.6;
  white-space: pre-line;
  margin-top: 4px;
}

.history-title {
  color: #8a4d5c;      /* æ·±è‰²æ¨™é¡Œï¼Œæ›´æ¸…æ¥š */
  font-weight: 700;
  margin-bottom: 4px;
}
      .card {
        width: 80px;
        height: 124px;
      }
    }
  </style>
</head>
<body>
  <div class="game-wrap">
    <!-- æ˜Ÿæ˜Ÿç²’å­å±¤ï¼ˆä¿ç•™åŸæœ¬å‹•ç•«ç”¨ï¼‰ -->
    <div class="star-layer" id="starLayer"></div>

    <!-- ä¸Šæ–¹ç°¡å–®è¿”å›éµï¼ˆä¹‹å¾Œä½ æœ‰ä¸»é¸å–®å°±æœƒç”¨åˆ°ï¼‰ -->
    <div style="margin-bottom: 8px;">
      <a href="index.html"
         style="display:inline-flex;align-items:center;gap:4px;
                padding:6px 10px;border-radius:999px;
                background:rgba(0,0,0,0.15);color:#f9e4c8;
                font-size:12px;text-decoration:none;">
        ğŸ  å›åˆ°å°å‹‡è€…ä¸»é 
      </a>
    </div>

    <!-- ä¸»å¡ç‰‡å€ -->
    <div class="card-panel">
      <h1>ç†Šç†Šå¡”ç¾…å åœ</h1>
      <div class="subtitle">æ·±å‘¼å¸ 3 ç§’ï¼Œå¿ƒè£¡é»˜å¿µå•é¡Œï¼Œç„¶å¾Œé»ä¸‹æŒ‰éˆ•ã€‚</div>
      <div class="star-divider">âœ¦ âœ¦ âœ¦</div>

      <div class="btn-bar">
        <button id="startBtn">é–‹å§‹å åœ</button>
      </div>

      <!-- ä¸‰å¼µç‰Œ -->
      <div class="table">
        <!-- éå» -->
        <div class="card-slot" data-position="past">
          <div class="slot-title">éå»</div>
          <div class="card">
            <div class="card-inner">
              <div class="card-face card-back">â˜…</div>
              <div class="card-face card-front">
                <div class="card-name"></div>
                <div class="card-tag"></div>
                <div class="card-meaning"></div>
                <div class="card-icon"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- ç¾åœ¨ -->
        <div class="card-slot" data-position="present">
          <div class="slot-title">ç¾åœ¨</div>
          <div class="card">
            <div class="card-inner">
              <div class="card-face card-back">â˜…</div>
              <div class="card-face card-front">
                <div class="card-name"></div>
                <div class="card-tag"></div>
                <div class="card-meaning"></div>
                <div class="card-icon"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- æœªä¾† -->
        <div class="card-slot" data-position="future">
          <div class="slot-title">æœªä¾†</div>
          <div class="card">
            <div class="card-inner">
              <div class="card-face card-back">â˜…</div>
              <div class="card-face card-front">
                <div class="card-name"></div>
                <div class="card-tag"></div>
                <div class="card-meaning"></div>
                <div class="card-icon"></div>
              </div>
            </div>
          </div>
        </div>
      </div><!-- .table -->
    </div><!-- .card-panel -->

    <!-- ç†Šç†Šçµæœé¢æ¿ï¼šåœ¨ä¸‰å¼µç‰Œã€Œä¸‹é¢ã€ï¼Œä¸å†é®ä½ -->
    <div id="resultPanel" class="result-panel">
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:8px;">
        <div style="font-size:26px;flex-shrink:0;">ğŸ»</div>
        <div style="flex:1;">
          <div style="font-weight:700;margin-bottom:4px;color:#8a4d5c;">
            æ‘é•·ç†Šç†Šçš„å°æé†’
          </div>
          <div id="resultText" class="result-panel-content">
            ä»Šå¤©çš„èƒ½é‡æ­£åœ¨æº–å‚™ä¸­â€¦
          </div>
        </div>
      </div>

      <!-- ä¸‹æ–¹æŒ‰éˆ•ï¼šå†å ä¸€æ¬¡ï¼ç´€éŒ„ï¼ä¸‹è¼‰ -->
      <div class="result-btns">
        <button id="againBtn">å†å ä¸€æ¬¡</button>
        <button id="toggleHistoryBtn">æŠ½ç‰Œç´€éŒ„</button>
        <button id="downloadBtn">ä¸‹è¼‰æ–‡å­—</button>
      </div>

      <!-- æŠ½ç‰Œç´€éŒ„é¡¯ç¤ºå€ï¼ˆä¹‹å¾Œ JS æœƒå¡«å…¥å…§å®¹ï¼‰ -->
      <div id="historyBox"
           style="margin-top:10px;border-top:1px dashed #e4c8aa;
                  padding-top:6px;font-size:12px;max-height:160px;overflow-y:auto;display:none;">
        <div style="color:#a88c93;">ç›®å‰é‚„æ²’æœ‰ç´€éŒ„å–”ï½å…ˆå®Œæˆä¸€æ¬¡å åœçœ‹çœ‹ã€‚</div>
      </div>
    </div>

    <div class="hint">æç¤ºï¼šæŒ‰ã€Œé–‹å§‹å åœã€å¾Œï¼Œä¾åºé»ä¸‰å¼µç‰Œç¿»é–‹å”· âœ¨</div>
  </div><!-- .game-wrap -->

<script>
// =============== 22 å¤§ç§˜å„€ï¼ˆå«æ­£ä½ï¼‹é€†ä½ï¼‹ç†Šç†ŠèªéŒ„ï¼‰ ===============
const tarotCards = [
  {
    name: "æ„šè€…",
    tag: "æ–°çš„é–‹å§‹ãƒ»è‡ªç”±ãƒ»æ—…ç¨‹",
    icon: "ğŸ’",
    upright: {
      meaning: "æ–°çš„æ—…ç¨‹ã€å‹‡æ•¢å˜—è©¦ã€å¸¶è‘—å¥½å¥‡å¿ƒå¾€å‰èµ°ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šæ¯ä¸€æ­¥éƒ½æ˜¯å†’éšªçš„é–‹å§‹ï¼Œä½ å·²ç¶“åšå¾—å¾ˆå¥½å›‰ï¼"
    },
    reversed: {
      meaning: "è¡å‹•æˆ–çŒ¶è±«ï¼Œéœ€è¦é‡æ–°æª¢è¦–æ–¹å‘ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šå…ˆåˆ¥æ€¥ï¼Œç­‰å¿ƒå®‰éœä¸‹ä¾†å†å‡ºç™¼ä¹Ÿæ²’é—œä¿‚ã€‚"
    }
  },
  {
    name: "é­”è¡“å¸«",
    tag: "è¡Œå‹•ãƒ»å‰µé€ ãƒ»å°ˆæ³¨",
    icon: "âœ¨",
    upright: {
      meaning: "ä½ æ“æœ‰è¶³å¤ çš„èƒ½åŠ›ï¼Œå¯ä»¥é–‹å§‹è¡Œå‹•ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ çœŸçš„å¾ˆæœ‰æ‰è¯ï¼Œç¾åœ¨å°±æ˜¯æœ€å¥½çš„é–‹å§‹æ™‚æ©Ÿï¼"
    },
    reversed: {
      meaning: "æ³¨æ„åˆ†å¿ƒã€å‹•åŠ›ä¸è¶³ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä¼‘æ¯ä¸€ä¸‹æ²’é—œä¿‚ï¼Œç­‰ä½ æº–å‚™å¥½ï¼Œéˆæ„Ÿæœƒå†æ¬¡å›ä¾†ã€‚"
    }
  },
  {
    name: "å¥³ç¥­å¸",
    tag: "ç›´è¦ºãƒ»å…§åœ¨ãƒ»éœå¿ƒ",
    icon: "ğŸŒ™",
    upright: {
      meaning: "ä¿¡ä»»ä½ çš„ç›´è¦ºï¼Œä½ å¿ƒè£¡å·²æœ‰ç­”æ¡ˆã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ å¿ƒè£¡çš„è²éŸ³å¾ˆæº«æŸ”ï¼Œä¹Ÿå€¼å¾—è¢«è½è¦‹ã€‚"
    },
    reversed: {
      meaning: "æƒ…ç·’æ··äº‚ï¼Œéœ€è¦æ›´å¤šä¼‘æ¯ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šåˆ¥å‹‰å¼·è‡ªå·±ï¼Œå¯ä»¥æ…¢æ…¢ä¾†ï¼Œæˆ‘é™ªä½ ä¸€èµ·ã€‚"
    }
  },
  {
    name: "çš‡å",
    tag: "æ»‹é¤Šãƒ»ç¾æ„Ÿãƒ»æ„›",
    icon: "ğŸ‘‘",
    upright: {
      meaning: "å€¼å¾—è¢«ç…§é¡§ã€è¢«æ„›ã€äº«å—ç”Ÿæ´»ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä»Šå¤©è«‹å°è‡ªå·±å¥½ä¸€é»ï¼Œä½ çœŸçš„å€¼å¾—æº«æŸ”ã€‚"
    },
    reversed: {
      meaning: "å¿½ç•¥è‡ªå·±ã€æƒ…ç·’ç–²ç´¯ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ å·²ç¶“å¾ˆåŠªåŠ›äº†ï¼Œè®“è‡ªå·±ä¼‘æ¯ä¸€ä¸‹å§ã€‚"
    }
  },
  {
    name: "çš‡å¸",
    tag: "çµæ§‹ãƒ»ç§©åºãƒ»è²¬ä»»",
    icon: "ğŸ›ï¸",
    upright: {
      meaning: "å»ºç«‹ç•Œç·šã€æŒæ§æ–¹å‘ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ æ¯”è‡ªå·±æƒ³åƒä¸­çš„é‚„è¦å …å¼·åˆç©©å®šå–”ï¼"
    },
    reversed: {
      meaning: "éåº¦æ§åˆ¶æˆ–å£“åŠ›ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ ä¸éœ€è¦ä¸€å€‹äººæ‰›æ‰€æœ‰ï¼Œç†Šç†Šé™ªè‘—ä½ ã€‚"
    }
  },
  {
    name: "æ•™çš‡",
    tag: "å­¸ç¿’ãƒ»æŒ‡å¼•ãƒ»å‚³çµ±",
    icon: "ğŸ“–",
    upright: {
      meaning: "å‘å°ˆæ¥­æ±‚åŠ©ã€æ±²å–çŸ¥è­˜ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šå‘äººå°‹æ±‚å¹«åŠ©æ˜¯å‹‡æ•¢çš„è¡¨ç¾ï¼Œä½ åšå¾—å¾ˆå¥½ã€‚"
    },
    reversed: {
      meaning: "æ¸´æœ›è‡ªç”±ã€ä¸æƒ³è¢«è¦å‰‡ç¶ä½ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ å¯ä»¥èµ°è‡ªå·±çš„è·¯ï¼Œä¸–ç•Œæœƒæ”¯æŒä½ çš„ã€‚"
    }
  },
  {
    name: "æˆ€äºº",
    tag: "é—œä¿‚ãƒ»é¸æ“‡ãƒ»åˆä¸€",
    icon: "ğŸ’–",
    upright: {
      meaning: "é—œä¿‚å’Œè«§ã€é‡è¦é¸æ“‡ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šçœŸèª çš„å¿ƒèƒ½æ‰“é€ æœ€ç¾çš„é€£çµã€‚"
    },
    reversed: {
      meaning: "èª¤æœƒã€çŒ¶è±«ã€æƒ…ç·’ä¸å¹³è¡¡ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šåˆ¥æ€¥ï¼Œå…ˆè½è½è‡ªå·±çœŸæ­£æƒ³è¦çš„æ˜¯ä»€éº¼ã€‚"
    }
  },
  {
    name: "æˆ°è»Š",
    tag: "æ„å¿—ãƒ»å‰é€²ãƒ»æŒæ§åŠ›",
    icon: "ğŸ‡",
    upright: {
      meaning: "çªç ´å›°é›£ã€æŒæ§æ–¹å‘ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ çœŸçš„å¾ˆåŠªåŠ›ï¼Œç†Šç†Šæ›¿ä½ æ‹æ‰‹ï¼"
    },
    reversed: {
      meaning: "æ–¹å‘ä¸æ¸…ã€å¤ªæ€¥èºã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šæ…¢ä¸€é»æ²’é—œä¿‚ï¼Œä½ æœƒçœ‹å¾—æ›´æ¸…æ¥šã€‚"
    }
  },
  {
    name: "åŠ›é‡",
    tag: "æº«æŸ”åŠ›é‡ãƒ»å‹‡æ°£",
    icon: "ğŸ¦",
    upright: {
      meaning: "å…§åœ¨åŠ›é‡ã€æº«æŸ”è‡ªä¿¡ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ æœ¬ä¾†å°±å¾ˆå‹‡æ•¢ï¼Œä¸éœ€è¦è­‰æ˜ä»€éº¼ã€‚"
    },
    reversed: {
      meaning: "ç–²å€¦ã€è‡ªæˆ‘æ‡·ç–‘ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šè®“ç†Šç†ŠæŠ±ä¸€ä¸‹ï¼Œä½ å€¼å¾—ä¼‘æ¯ã€‚"
    }
  },
  {
    name: "éš±è€…",
    tag: "å…§çœãƒ»æ™ºæ…§ãƒ»ç¨è™•",
    icon: "ğŸ•¯ï¸",
    upright: {
      meaning: "å®‰éœæ²‰æ¾±ã€æ‰¾åˆ°æ–¹å‘ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ çš„å¿ƒå¾ˆè°æ˜ï¼Œåªéœ€è¦å¤šä¸€äº›å®‰éœã€‚"
    },
    reversed: {
      meaning: "å­¤å–®ã€å°é–‰å¤ªä¹…ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ ä¸ç”¨ä¸€å€‹äººï¼Œæˆ‘åœ¨é€™è£¡é™ªä½ ã€‚"
    }
  },
  {
    name: "å‘½é‹ä¹‹è¼ª",
    tag: "è½‰è®Šãƒ»é‹å‹¢ãƒ»æ©Ÿæœƒ",
    icon: "ğŸ¡",
    upright: {
      meaning: "å¥½é‹ä¾†è‡¨ã€äº‹æƒ…åŠ é€Ÿã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ çš„å‘½é‹ä¹‹è¼ªæ­£åœ¨è½‰å‘æ›´å¥½çš„åœ°æ–¹ï¼"
    },
    reversed: {
      meaning: "åœæ»¯ã€åè¦†ã€æ™‚æ©Ÿæœªåˆ°ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šåˆ¥æ€•ï¼Œä½ æƒ³è¦çš„æ­£åœ¨æ…¢æ…¢é è¿‘ä½ ã€‚"
    }
  },
  {
    name: "æ­£ç¾©",
    tag: "å¹³è¡¡ãƒ»èª å¯¦ãƒ»çœŸç›¸",
    icon: "âš–ï¸",
    upright: {
      meaning: "å…¬å¹³ã€ç†æ€§ã€éœ€è¦é¢å°çœŸå¯¦ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ é¡˜æ„èª å¯¦ï¼Œå·²ç¶“æ¯”å¾ˆå¤šäººå¼·å¤§äº†ã€‚"
    },
    reversed: {
      meaning: "æ„Ÿåˆ°ä¸å…¬å¹³ã€èª¤æœƒã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ å€¼å¾—è¢«ç†è§£ï¼Œè«‹å…ˆç…§é¡§å¥½è‡ªå·±çš„å¿ƒã€‚"
    }
  },
  {
    name: "åŠäºº",
    tag: "ç­‰å¾…ãƒ»è½‰åŒ–ãƒ»æ–°è¦–è§’",
    icon: "ğŸªœ",
    upright: {
      meaning: "åœä¸‹æ‰èƒ½çœ‹è¦‹æ–°æ–¹å‘ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šæ…¢ä¸‹ä¾†ä¸æ˜¯è½å¾Œï¼Œè€Œæ˜¯è®“å¥‡è¹Ÿè¿½ä¸Šä½ ã€‚"
    },
    reversed: {
      meaning: "å¡ä½ã€æŠ—æ‹’æ”¹è®Šã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šå°å°ä¸€æ­¥å°±å¾ˆå¥½ï¼Œä½ ä¸éœ€è¦ä¸€æ¬¡æ”¹è®Šå…¨éƒ¨ã€‚"
    }
  },
  {
    name: "æ­»ç¥",
    tag: "çµæŸãƒ»é‡ç”Ÿãƒ»è½‰åŒ–",
    icon: "â˜ ï¸",
    upright: {
      meaning: "èˆŠçš„çµæŸã€æ–°çš„é–‹å§‹ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šæ”¾ä¸‹ä¸æ˜¯å¤±å»ï¼Œæ˜¯ç‚ºäº†è¿æ¥æ›´å¥½çš„ã€‚"
    },
    reversed: {
      meaning: "å®³æ€•æ”¹è®Šã€åœæ»¯ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä¸ç”¨æ€¥ï¼Œç†Šç†Šæœƒé™ªè‘—ä½ æ…¢æ…¢å¾€å‰ã€‚"
    }
  },
  {
    name: "ç¯€åˆ¶",
    tag: "å¹³è¡¡ãƒ»ç™‚ç™’ãƒ»æµå‹•",
    icon: "ğŸ’§",
    upright: {
      meaning: "æ‰¾åˆ°è‡ªå·±çš„ç¯€å¥ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šèˆ’æœçš„æ­¥ä¼ï¼Œå°±æ˜¯æœ€å¥½çš„é€Ÿåº¦ã€‚"
    },
    reversed: {
      meaning: "å¤±è¡¡ã€éåº¦æˆ–ä¸è¶³ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ å€¼å¾—ä¼‘æ¯ï¼Œä¹Ÿå€¼å¾—é‡ç²å¹³è¡¡ã€‚"
    }
  },
  {
    name: "æƒ¡é­”",
    tag: "æŸç¸›ãƒ»æ…¾æœ›ãƒ»å£“åŠ›",
    icon: "ğŸ˜ˆ",
    upright: {
      meaning: "çœ‹è¦‹å•é¡Œã€é–‹å§‹è§£æ”¾ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šçœ‹è¦‹é™°å½±ä¸¦ä¸å¯æ€•ï¼Œä½ æ¯”å®ƒå€‘æ›´å¼·å¤§ã€‚"
    },
    reversed: {
      meaning: "è„«é›¢å£ç¿’æ…£ã€é‡ç²è‡ªç”±ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ æ­£åœ¨è®Šå¾—æ›´è‡ªç”±ï¼Œå¥½æ£’ï¼"
    }
  },
  {
    name: "é«˜å¡”",
    tag: "åŠ‡è®Šãƒ»é‡å»ºãƒ»çœŸç›¸",
    icon: "ğŸ°",
    upright: {
      meaning: "èˆŠçµæ§‹å´©è§£ï¼Œæ˜¯é‡å»ºçš„é–‹å§‹ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šé›–ç„¶ä¸èˆ’æœï¼Œä½†é€™æœƒå¸¶ä½ èµ°å‘æ›´å¥½çš„æœªä¾†ã€‚"
    },
    reversed: {
      meaning: "æ“”å¿ƒå¤±æ§ã€å®³æ€•å´©å£ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šæ…¢æ…¢é¢å°å°±å¥½ï¼Œä½ ä¸éœ€è¦ä¸€æ¬¡è™•ç†å…¨éƒ¨ã€‚"
    }
  },
  {
    name: "æ˜Ÿæ˜Ÿ",
    tag: "å¸Œæœ›ãƒ»ç™‚ç™’ãƒ»é¡˜æœ›",
    icon: "â­",
    upright: {
      meaning: "å¸Œæœ›èˆ‡å…‰æ­£åœ¨é è¿‘ä½ ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ å€¼å¾—è¢«å…‰ç…§äº®ï¼Œæœªä¾†æœƒè¶Šä¾†è¶Šå¥½çš„ã€‚"
    },
    reversed: {
      meaning: "å¤±å»æ–¹å‘ã€èƒ½é‡ä¸è¶³ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šå…ˆä¼‘æ¯ä¸€ä¸‹ï¼Œæ˜Ÿæ˜Ÿæœƒåœ¨å¤œè£¡ç­‰ä½ ã€‚"
    }
  },
  {
    name: "æœˆäº®",
    tag: "æƒ…ç·’ãƒ»æ½›æ„è­˜ãƒ»è¿·éœ§",
    icon: "ğŸŒ™",
    upright: {
      meaning: "æ•æ„Ÿã€ç›´è¦ºã€æƒ…ç·’æ³¢å‹•ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ çš„æ„Ÿå—éƒ½å¾ˆé‡è¦ï¼Œè«‹ä¸è¦å¿½ç•¥è‡ªå·±ã€‚"
    },
    reversed: {
      meaning: "å®³æ€•ã€æƒ³åƒéåº¦ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šåšä¸€ä»¶å°å°çš„äº‹ï¼Œä½ æœƒæ…¢æ…¢ç©©å®šä¸‹ä¾†ã€‚"
    }
  },
  {
    name: "å¤ªé™½",
    tag: "å–œæ‚…ãƒ»æˆåŠŸãƒ»è‡ªä¿¡",
    icon: "â˜€ï¸",
    upright: {
      meaning: "èƒ½é‡æ»¿æ»¿ã€å–œæ‚…èˆ‡æˆåŠŸã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ çœŸçš„å¾ˆæ£’ï¼ä¸–ç•Œæ­£åœ¨ç‚ºä½ æ‹æ‰‹å–”ï½"
    },
    reversed: {
      meaning: "ç´¯äº†ã€å…‰è®Šå¼±ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šç™¼å…‰ä¸æ˜¯ç¾©å‹™ï¼Œç´¯äº†å°±ä¾†ç†Šç†Šé€™è£¡å……é›»ã€‚"
    }
  },
  {
    name: "å¯©åˆ¤",
    tag: "å¾©æ´»ãƒ»é†’æ‚Ÿãƒ»å¬å–š",
    icon: "ğŸ“£",
    upright: {
      meaning: "ç¬¬äºŒæ¬¡æ©Ÿæœƒã€é‡æ–°é–‹å§‹ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ æ¯”ä»¥å‰æ›´æˆç†Ÿï¼Œé€™æ¬¡ä½ æœƒåšå¾—æ›´å¥½ã€‚"
    },
    reversed: {
      meaning: "ç³¾çµã€ä¸æ•¢æ”¾ä¸‹ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä½ å·²ç¶“ç›¡åŠ›äº†ï¼Œå¯ä»¥æº«æŸ”åœ°æ”¾éè‡ªå·±ã€‚"
    }
  },
  {
    name: "ä¸–ç•Œ",
    tag: "å®Œæˆãƒ»æ•´åˆãƒ»åœ“æ»¿",
    icon: "ğŸŒ",
    upright: {
      meaning: "ä»»å‹™å®Œæˆã€é€²å…¥æ–°éšæ®µã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šæ­å–œä½ ï¼ä½ çš„åŠªåŠ›æ­£åœ¨é–‹èŠ±çµæœã€‚"
    },
    reversed: {
      meaning: "å·®æœ€å¾Œä¸€æ­¥ã€æœªå®Œæˆã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šå†åŠªåŠ›ä¸€ä¸‹ä¸‹ï¼Œä½ å°±æœƒçœ‹åˆ°å¾ˆç¾çš„çµæœã€‚"
    }
  }
];

// =============== DOM é¸å– ===============
const startBtn = document.getElementById("startBtn");
const againBtn = document.getElementById("againBtn");
const toggleHistoryBtn = document.getElementById("toggleHistoryBtn");
const downloadBtn = document.getElementById("downloadBtn");

const resultPanel = document.getElementById("resultPanel");
const resultText = document.getElementById("resultText");
const historyBox = document.getElementById("historyBox");

const starLayer = document.getElementById("starLayer");

// ä¸‰å¼µç‰Œ DOM
const slots = {
  past: document.querySelector('.card-slot[data-position="past"] .card'),
  present: document.querySelector('.card-slot[data-position="present"] .card'),
  future: document.querySelector('.card-slot[data-position="future"] .card')
};

// =============== æŠ½ç‰Œç´€éŒ„ï¼ˆlocalStorageï¼‰ ===============
const HISTORY_KEY = "bearTarotHistoryV1";
let historyList = [];   // { time: "02/03 11:54", text: "..." }

function loadHistory() {
  try {
    const raw = localStorage.getItem(HISTORY_KEY);
    if (!raw) return;
    const parsed = JSON.parse(raw);
    if (Array.isArray(parsed)) {
      historyList = parsed;
    }
  } catch (e) {
    console.warn("è®€å–å åœç´€éŒ„å¤±æ•—ï¼š", e);
  }
}

function saveHistory() {
  try {
    localStorage.setItem(HISTORY_KEY, JSON.stringify(historyList));
  } catch (e) {
    console.warn("å„²å­˜å åœç´€éŒ„å¤±æ•—ï¼š", e);
  }
}

function updateHistoryBox() {
  if (!historyList.length) {
    historyBox.innerHTML =
      '<div style="color:#a88c93;">ç›®å‰é‚„æ²’æœ‰ç´€éŒ„å–”ï½å…ˆå®Œæˆä¸€æ¬¡å åœçœ‹çœ‹ã€‚</div>';
    return;
  }

  historyBox.innerHTML = historyList
    .map((item, index) => {
      return `
        <div style="margin-bottom:14px;">
          <div class="history-title">
            ç¬¬ ${index + 1} æ¬¡å åœï¼ˆ${item.time}ï¼‰
          </div>
          <pre>${item.text}</pre>
        </div>
      `;
    })
    .join("");
}

// =============== å·¥å…·ï¼šæ´—ç‰Œ ===============
function shuffle(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// =============== æ˜Ÿæ˜Ÿç²’å­å‹•ç•« ===============
function spawnStar(x, y, count = 8) {
  const rect = starLayer.getBoundingClientRect();
  for (let i = 0; i < count; i++) {
    const el = document.createElement("div");
    el.className = "star";
    el.style.left = x - rect.left + (Math.random() * 40 - 20) + "px";
    el.style.top = y - rect.top + (Math.random() * 20 - 10) + "px";
    el.style.animationDelay = (Math.random() * 0.25) + "s";
    starLayer.appendChild(el);
    el.addEventListener("animationend", () => el.remove());
  }
}

// =============== æŠ½åˆ°çš„ç‰Œ â†’ å¡«å…¥å¡ç‰‡å‰é¢ ===============
function fillCard(cardEl, data) {
  const { card, reversed } = data;

  cardEl.classList.toggle("is-reversed", reversed);

  const nameEl = cardEl.querySelector(".card-name");
  const tagEl = cardEl.querySelector(".card-tag");
  const meaningEl = cardEl.querySelector(".card-meaning");
  const iconEl = cardEl.querySelector(".card-icon");

  nameEl.textContent = card.name + (reversed ? "ï¼ˆé€†ä½ï¼‰" : "ï¼ˆæ­£ä½ï¼‰");
  tagEl.textContent = card.tag;
  meaningEl.textContent = reversed ? card.reversed.meaning : card.upright.meaning;
  iconEl.textContent = card.icon;
}

// =============== çµ„åˆç†Šç†Šè¨Šæ¯ ===============
function buildBearMessage(r) {
  function part(label, slot) {
    const side = slot.reversed ? slot.card.reversed : slot.card.upright;
    const pos = slot.reversed ? "ï¼ˆé€†ä½ï¼‰" : "ï¼ˆæ­£ä½ï¼‰";
    return `${label}ï¼š${slot.card.name}${pos}\nç‰Œçš„æé†’ï¼š${side.meaning}\n${side.bear}\n`;
  }

  return (
    part("éå»", r.past) +
    "\n" +
    part("ç¾åœ¨", r.present) +
    "\n" +
    part("æœªä¾†", r.future) +
    "\nğŸ» æ‘é•·ç†Šç†Šå°ç¸½çµï¼š\nç‰Œåªæ˜¯æé†’ï¼Œä¸æ˜¯å‘½ä»¤ã€‚\nä½ å¯ä»¥ç…§è‡ªå·±çš„æ­¥èª¿æ…¢æ…¢å‰é€²ï¼Œç†Šç†Šæœƒä¸€ç›´åœ¨é€™è£¡é™ªä½ ã€‚"
  );
}

// =============== ä¸‹è¼‰æ–‡å­—æª” ===============
function downloadReading(text) {
  const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "ä»Šæ—¥ç†Šç†Šå åœ.txt";
  a.click();

  URL.revokeObjectURL(url);
}

// =============== é–‹å§‹å åœ ===============
let reading = null;
let flippedCount = 0;

function startReading() {
  const shuffled = shuffle(tarotCards);

  reading = {
    past: { card: shuffled[0], reversed: Math.random() < 0.5 },
    present: { card: shuffled[1], reversed: Math.random() < 0.5 },
    future: { card: shuffled[2], reversed: Math.random() < 0.5 }
  };

  flippedCount = 0;
  resultPanel.style.display = "none";

  // åˆå§‹åŒ–å¡ç‰‡
  Object.entries(slots).forEach(([k, cardEl]) => {
    cardEl.classList.remove("flipped", "is-reversed", "show");
    cardEl.style.pointerEvents = "auto";
    void cardEl.offsetWidth; // é‡ç½®å‹•ç•«
    fillCard(cardEl, reading[k]);
    cardEl.classList.add("show");
  });

  const r = startBtn.getBoundingClientRect();
  spawnStar(r.left + r.width / 2, r.top);

  startBtn.disabled = true;
  setTimeout(() => (startBtn.disabled = false), 800);
}

// =============== ç¶å®šå¡ç‰‡é»æ“Š ===============
Object.entries(slots).forEach(([key, cardEl]) => {
  cardEl.addEventListener("click", () => {
    if (!reading) return;
    if (cardEl.classList.contains("flipped")) return;

    cardEl.classList.add("flipped");
    flippedCount++;

    const r = cardEl.getBoundingClientRect();
    spawnStar(r.left + r.width / 2, r.top + r.height / 2, 10);

    if (flippedCount === 3) {
      setTimeout(() => {
        const msg = buildBearMessage(reading);

        // é¡¯ç¤ºåˆ°ç†Šç†Šçµæœå¤§å¡ç‰‡
        resultText.textContent = msg;
        resultPanel.style.display = "block";

        // âŠ ç”¢ç”Ÿæ™‚é–“æ¨™ç±¤ï¼ˆå«æ—¥æœŸï¼‹æ™‚é–“ï¼‰
        const now = new Date();
        const timeLabel = now.toLocaleString("zh-TW", {
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit"
        });

        // â‹ å­˜å…¥é™£åˆ—é–‹é ­ï¼ˆæœ€æ–°çš„åœ¨æœ€ä¸Šé¢ï¼‰
        historyList.unshift({
          time: timeLabel,
          text: msg
        });

        // âŒ å­˜åˆ° localStorage
        saveHistory();

        // â é‡æ–°æ¸²æŸ“ç•«é¢
        updateHistoryBox();
      }, 600);
    }
  });
});

// =============== æŒ‰éˆ•åŠŸèƒ½ ===============
startBtn.addEventListener("click", startReading);
againBtn.addEventListener("click", startReading);

toggleHistoryBtn.addEventListener("click", () => {
  historyBox.style.display =
    historyBox.style.display === "none" ? "block" : "none";
});

downloadBtn.addEventListener("click", () => {
  downloadReading(resultText.textContent);
});

// âœ… é é¢è¼‰å…¥æ™‚å…ˆæŠŠæ­·å²ç´€éŒ„æŠ“å›ä¾†
loadHistory();
updateHistoryBox();
</script>
</body>
</html>
